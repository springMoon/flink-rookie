## 跟进记录
```csv
1、用户跟进记录表，分析用户跟进次数，取出每次跟进的 激活时间（状态2,3 中小的一条）和跟进失败时间（状态9）
2、每个用户跟进状态一定从 1 开始，直到 9 结束一次跟进
3、跟进状态可以重复和累加，不能递减
4、状态变化可以跳跃
5、激活时间为一次跟进过程中状态为 2 或 3 中时间小的一条记录

表结构、数据如下：

create table clue_log(
    user_id bigint,
    create_time datetime,
    status   int
)
ENGINE=OLAP
DUPLICATE KEY(user_id)
DISTRIBUTED BY HASH(user_id) BUCKETS 8;

insert into clue_log values
(1,'2022-08-15 16:20:00', 1),
(1,'2022-08-15 16:20:30', 2),
(1,'2022-08-15 16:21:00', 3),
(1,'2022-08-15 16:22:00', 4),
(1,'2022-08-15 16:23:00', 5),
(1,'2022-08-15 16:24:00', 9),

(1,'2022-08-15 16:25:10', 1),
(1,'2022-08-15 16:25:11', 1),
(1,'2022-08-15 16:25:12', 1),
(1,'2022-08-15 16:25:20', 3),
(1,'2022-08-15 16:25:30', 4),
(1,'2022-08-15 16:25:40', 5),
(1,'2022-08-15 16:25:50', 9),

(1,'2022-08-15 16:26:10', 1),
(1,'2022-08-15 16:26:11', 2),
(1,'2022-08-15 16:26:12', 2),
(1,'2022-08-15 16:26:13', 2),
(1,'2022-08-15 16:26:14', 3),
(1,'2022-08-15 16:26:15', 4),
(1,'2022-08-15 16:26:16', 5),
(1,'2022-08-15 16:26:19', 9),

(1,'2022-08-15 16:27:10', 1),
(1,'2022-08-15 16:27:12', 3),
(1,'2022-08-15 16:27:13', 3),
(1,'2022-08-15 16:27:14', 3),
(1,'2022-08-15 16:27:15', 4),
(1,'2022-08-15 16:27:16', 5),

(1,'2022-08-15 16:27:19', 9);


insert into clue_log values
(2,'2022-08-15 16:20:00', 1),
(2,'2022-08-15 16:20:30', 2),
(2,'2022-08-15 16:21:00', 3),
(2,'2022-08-15 16:22:00', 4),
(2,'2022-08-15 16:23:00', 5),
(2,'2022-08-15 16:24:00', 9),
(2,'2022-08-15 16:25:10', 1),
(2,'2022-08-15 16:25:20', 3),
(2,'2022-08-15 16:25:30', 4),
(2,'2022-08-15 16:25:40', 5),
(2,'2022-08-15 16:25:50', 9),
(2,'2022-08-15 16:26:10', 1),
(2,'2022-08-15 16:26:11', 2),
(2,'2022-08-15 16:26:12', 2),
(2,'2022-08-15 16:26:13', 2),
(2,'2022-08-15 16:26:14', 3),
(2,'2022-08-15 16:26:15', 4),
(2,'2022-08-15 16:26:16', 5),
(2,'2022-08-15 16:26:19', 9),
(2,'2022-08-15 16:27:10', 1),
(2,'2022-08-15 16:27:12', 3),
(2,'2022-08-15 16:27:13', 3),
(2,'2022-08-15 16:27:14', 3),
(2,'2022-08-15 16:27:15', 4),
(2,'2022-08-15 16:27:16', 5),
(2,'2022-08-15 16:27:19', 9);

select user_id, active_time,fail_time 
from (
  select a.user_id, min(if(b.status in (2,3) , b.create_time, null)) active_time, min(if(b.status in (9) , b.create_time, null)) fail_time
  from clue_log a 
    left join clue_log b on a.user_id = b.user_id and b.create_time >= a.create_time
  where a.status = 1
  group by a.user_id, a.create_time
)a
where fail_time is not null
group by user_id, active_time,fail_time
;

```